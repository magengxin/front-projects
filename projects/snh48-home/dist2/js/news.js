"use strict";$(function(){function t(){$(".to-qq").attr("href",n.url)}function e(t){var e=Date.now();t.css("pointer-events","none");var n=setInterval(function(){var o=Date.now(),a=((o-e)/1e3).toFixed(0),c=60-a;if(c<0)return t.css("pointer-events","all"),t.html("获取验证码"),clearInterval(n);t.html(c)},1e3)}var n={url:"//shang.qq.com/wpa/qunwpa?idkey=594e78830030b5c8d1b1a34fd11f753e4ed6ceb903332b6a3f55c01671428e04",ewm:"http://snh48.thedream.cc/dcms_upfiles/32exLwHYKaXOSpfv1495005531.png",number:"340920444",other:"http://snh48.thedream.cc/dcms_upfiles/ZwqDGMojViHCetcP1495005535.png"};!function(){$.ajax({type:"jsonp",method:"GET",url:"http://dcms.thedream.cc/snh48/qq_ewm",dataType:"jsonp",success:function(e){"0"==e.ret_code&&(n=e.data,t())},err:function(t){console.log(t)}})}();var o="ios";$(".phone-tabs .tab").on("click",function(t){var e=$(t.currentTarget);e.addClass("active").siblings().removeClass("active"),o=e.attr("data-tag")});var a=$(".dialog-commit"),c=(a.find(".submit"),$(".dialog-commit .icon-close"),$(".ercode")),r=!1;c.click(function(){if(r)return toast("正在发送验证码，请稍后");var t=$(this);if(!o)return toast("数据错误");var n=$(".form"),a=n.find(".phone"),c=a.val().trim();if(!c||11!=c.length)return toast("请输入手机号");r=!0,t.html("发送中"),$.ajax({type:"jsonp",method:"GET",url:"http://dcms.thedream.cc/snh48/code/send?cell="+c,dataType:"jsonp",success:function(n){if(r=!1,"0"!==n.ret_code)return t.html("发送验证码"),toast(n.ret_msg);e(t)},err:function(e){return r=!1,console.log(e),t.html("发送验证码"),toast(e.ret_msg)}})});var s=$(".btn.submit"),i=!1;if(s.click(function(){if(i)return toast("正在发送中，请稍后");$(this);if(!o)return toast("数据错误");var t=$(".content-box"),e=t.find(".phone"),n=e.val().trim();if(!n||11!=n.length)return toast("请输入手机号");var a=t.find(".code").val().trim();if(!a||6!=a.length)return toast("请输入验证码");i=!0,$.ajax({type:"jsonp",method:"POST",url:"http://dcms.thedream.cc/snh48/code/confirm",data:{cell:n,code:a,os:"android"==o?1:2},dataType:"jsonp",success:function(t){if(i=!1,"0"!==t.ret_code)return toast(t.ret_msg);toast("申请成功")},err:function(t){i=!1,console.log(t)}})}),$(".view-news-detail").length){var m=function(){return u?r?toast("正在加载，亲稍后"):(r=!0,void $.ajax({type:"GET",url:"http://dcms.thedream.cc/snh48/news/comment/paging",data:{kid:d,offset:l},dataType:"jsonp",success:function(t){if(console.log(t),r=!1,"0"!==t.ret_code)return toast(t.ret_msg);var e=t.list;u=t.next;var n=t.cnt;n&&$(".conmment-box h2 span").html(n),u?$(".btn-more").css("display","block"):$(".btn-more").hide(),e.length&&(l=t.offset,$(".comments").append(T.comments({list:e})))},err:function(t){r=!1}})):toast("没有更多")},d=$("#kid").val()||1,l=0,u=!0;r=!1,m();var f=!1;$(".commit").click(function(){$(this);if(f)return toast("正在发送，亲稍后");var t=$(".comment-field input"),e=t.val();return console.log(e),e?e.length>15?toast("最多可输入15个字"):e.length<2?toast("最少输入2个字"):(f=!0,void $.ajax({type:"POST",url:"http://dcms.thedream.cc/snh48/news/comment",data:{comment:e,kid:d,url:location.href},dataType:"jsonp",success:function(n){if(console.log(n),f=!1,"0"!==n.ret_code)return toast(n.ret_msg);var o=$('<a class="comment color-red" href="javascript:" data-id="'+n.data_id+'" data-cnt="0")>'+e+"</a>");$(".comments .comment").length?o.insertBefore($(".comments .comment").eq(0)):$(".comments").append(o),t.val(""),toast("发表成功")},err:function(t){f=!1}})):toast("请输入评论内容")});var h=!1;$(".conmment-box").on("click",".comment",function(t){var e=$(t.currentTarget);if(console.log(e),h)return toast("正在发送，亲稍后");var n=e.attr("data-id"),o=e.attr("data-cnt");if(o=parseInt(o),!n)return toast("数据错误");h=!0,$.ajax({type:"POST",url:"http://dcms.thedream.cc/snh48/news/comment/like",data:{kid:d,data_id:n},dataType:"jsonp",success:function(t){if(console.log(t),h=!1,"0"!==t.ret_code)return toast(t.ret_msg);toast("点赞成功"),o++,e.attr("data-cnt",o)},err:function(t){h=!1}})}),$(".btn-more").click(function(){m()})}$(".wait").click(function(t){t.preventDefault(),toast("敬请期待")})});